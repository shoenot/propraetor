{% extends base_template %}
{% block title %}requisitions.{% endblock %}
{% block content %}
<div class="detail-breadcrumb">
    <a href="{% url 'propraetor:dashboard' %}">~</a>
    <span> / </span>
    <span>requisitions</span>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">pending_requests</div>
        <div class="stat-value">{{ pending_requests }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">high_priority_requests</div>
        <div class="stat-value">{{ high_priority_requests }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">fulfilled_this_month</div>
        <div class="stat-value">{{ fulfilled_this_month }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">fulfilled_this_year</div>
        <div class="stat-value">{{ fulfilled_this_year }}</div>
    </div>
</div>

<!-- Search and Filters -->
<div class="actions-bar">
    <div class="actions-left">
        <div class="search-box">
            <svg
                class="search-icon icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                ></path>
            </svg>
            <input
                type="text"
                class="search-input"
                placeholder="search assets, users, models..."
                name="q"
                hx-get="{{ rows_url }}"
                hx-trigger="input changed delay:100ms, search"
                hx-target="#table-container-{{ table_id }}"
                hx-swap="innerHTML"
                hx-include="[name='status']"
            />
            <span id="search-spinner" class="htmx-indicator">ðŸ”„</span>
        </div>
        <select
            class="filter-select"
            hx-get="{{ rows_url }}"
            hx-trigger="change"
            hx-target="#table-container-{{ table_id }}"
            hx-swap="innerHTML"
            name="priority"
        >
            <option value="">priority</option>
            <option value="low">low</option>
            <option value="normal">normal</option>
            <option value="high">high</option>
            <option value="urgent">urgent</option>
        </select>
        <select
            class="filter-select"
            hx-get="{{ rows_url }}"
            hx-trigger="change"
            hx-target="#table-container-{{ table_id }}"
            hx-swap="innerHTML"
            name="status"
        >
            <option value="">all_statuses</option>
            <option value="fulfilled">fulfilled</option>
            <option value="pending">pending</option>
            <option value="cancelled">cancelled</option>
        </select>
    </div>
    <div class="actions-right">
        <a href="{% url 'propraetor:requisition_create' %}" class="btn btn-primary">
            <svg
                class="icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                ></path>
            </svg>
            new_requisition
        </a>
        <button
            class="btn btn-secondary"
            hx-get="{% url 'propraetor:requisition_list' %}"
            hx-target="#table-container-{{ table_id }}"
            hx-swap="innerHTML"
            hx-include="[name='q'], [name='status'], [name='priority']"
        >
            <svg
                class="icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                ></path>
            </svg>
            refresh
        </button>
    </div>
</div>

<!-- Table -->
<div class="table-container table-section" id="table-container-{{ table_id }}">
    {% include 'partials/reusable_table.html' %}
</div>
{% endblock %}
